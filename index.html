<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced DVT Log Analyzer - Obol Network</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: system-ui, sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%);
            min-height: 100vh;
        }
        .chat-scroll {
            scrollbar-width: thin;
            scrollbar-color: rgba(100, 255, 218, 0.3) transparent;
        }
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .chat-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .chat-scroll::-webkit-scrollbar-thumb {
            background-color: rgba(100, 255, 218, 0.3);
            border-radius: 3px;
        }
        .typing-animation {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .message-animation {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="padding: 2rem; text-align: center; color: white;">
            <h1>Enhanced DVT Log Analyzer</h1>
            <p>Loading...</p>
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const EnhancedDVTLogAnalyzer = () => {
            const [files, setFiles] = useState([]);
            const [messages, setMessages] = useState([
                {
                    id: 1,
                    type: 'assistant',
                    content: `Welcome to the Enhanced DVT Log Analyzer! üöÄ

I'm your AI assistant specialized in Obol Network DVT analysis. Here's what I can help you with:

**üìÅ Upload & Analyze:** Drop your DVT log files and I'll provide comprehensive analysis
**üîç Interactive Queries:** Ask specific questions about your logs:
  ‚Ä¢ "Show me all Charon errors in the last hour"
  ‚Ä¢ "Analyze consensus failures in my cluster"
  ‚Ä¢ "What MEV-Boost issues do you see?"
  ‚Ä¢ "Check cluster health status"

**üìö Obol Documentation:** Get contextual links to relevant Obol docs
**‚ö° Real-time Analysis:** Chat with your logs for instant insights

Upload your files and start asking questions!`,
                    timestamp: new Date()
                }
            ]);
            
            const [inputMessage, setInputMessage] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [logData, setLogData] = useState({});
            const [analysisMode, setAnalysisMode] = useState('interactive'); // 'interactive' or 'bulk'
            
            const chatEndRef = useRef(null);
            const fileInputRef = useRef(null);
            const textareaRef = useRef(null);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            useEffect(() => {
                const textarea = textareaRef.current;
                if (textarea) {
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
                }
            }, [inputMessage]);

            const handleFileUpload = async (event) => {
                const uploadedFiles = Array.from(event.target.files);
                const processedFiles = [];
                const newLogData = { ...logData };

                for (const file of uploadedFiles) {
                    const content = await readFileContent(file);
                    const fileInfo = {
                        id: Math.random().toString(36).substr(2, 9),
                        name: file.name,
                        size: file.size,
                        type: getFileType(file.name),
                        file: file,
                        uploadTime: new Date()
                    };
                    
                    processedFiles.push(fileInfo);
                    newLogData[file.name] = {
                        content,
                        lines: content.split('\n'),
                        analysis: analyzeFileStructure(content, file.name)
                    };
                }

                setFiles(prev => [...prev, ...processedFiles]);
                setLogData(newLogData);

                // Add confirmation message
                addMessage('assistant', `‚úÖ **Files Uploaded Successfully!**

Processed ${processedFiles.length} files:
${processedFiles.map(f => `‚Ä¢ **${f.name}** (${f.type}) - ${formatFileSize(f.size)}`).join('\n')}

**Quick Analysis Available:**
${Object.values(newLogData).map(data => {
    const stats = data.analysis;
    return `‚Ä¢ ${stats.totalLines.toLocaleString()} lines, ${stats.errors} errors, ${stats.warnings} warnings`;
}).join('\n')}

**Try asking:** 
"Show me a summary of all errors" or "What consensus issues do you see?"`, false);
            };

            const readFileContent = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            };

            const getFileType = (filename) => {
                const name = filename.toLowerCase();
                if (name.includes('charon')) return 'charon';
                if (name.includes('lighthouse')) return 'lighthouse';
                if (name.includes('mev') || name.includes('boost')) return 'mev-boost';
                if (name.includes('beacon')) return 'beacon';
                if (name.includes('lodestar')) return 'lodestar';
                return 'other';
            };

            const analyzeFileStructure = (content, filename) => {
                const lines = content.split('\n');
                const analysis = {
                    totalLines: lines.length,
                    errors: 0,
                    warnings: 0,
                    timestamps: [],
                    modules: new Set(),
                    consensusEvents: [],
                    charonEvents: [],
                    mevEvents: [],
                    criticalIssues: []
                };

                lines.forEach((line, index) => {
                    const lowerLine = line.toLowerCase();
                    
                    // Count errors and warnings
                    if (lowerLine.includes('error') || lowerLine.includes('fatal')) {
                        analysis.errors++;
                        if (lowerLine.includes('critical') || lowerLine.includes('fatal')) {
                            analysis.criticalIssues.push({ line: index + 1, content: line.trim() });
                        }
                    }
                    if (lowerLine.includes('warn')) analysis.warnings++;
                    
                    // Extract timestamps
                    const timeMatch = line.match(/\d{4}-\d{2}-\d{2}[T\s]\d{2}:\d{2}:\d{2}/);
                    if (timeMatch) analysis.timestamps.push({ line: index + 1, timestamp: timeMatch[0] });
                    
                    // DVT-specific events
                    if (lowerLine.includes('consensus') || lowerLine.includes('qbft') || lowerLine.includes('leader')) {
                        analysis.consensusEvents.push({ line: index + 1, content: line.trim() });
                    }
                    if (lowerLine.includes('charon')) {
                        analysis.charonEvents.push({ line: index + 1, content: line.trim() });
                    }
                    if (lowerLine.includes('mev') || lowerLine.includes('relay')) {
                        analysis.mevEvents.push({ line: index + 1, content: line.trim() });
                    }
                });

                return analysis;
            };

            const formatFileSize = (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };

            const addMessage = (type, content, showTyping = true) => {
                if (showTyping && type === 'assistant') {
                    setIsTyping(true);
                    setTimeout(() => {
                        setMessages(prev => [...prev, {
                            id: Date.now(),
                            type,
                            content,
                            timestamp: new Date()
                        }]);
                        setIsTyping(false);
                    }, 1000 + Math.random() * 1500);
                } else {
                    setMessages(prev => [...prev, {
                        id: Date.now(),
                        type,
                        content,
                        timestamp: new Date()
                    }]);
                }
            };

            const processUserQuery = async (query) => {
                if (Object.keys(logData).length === 0) {
                    return "Please upload some DVT log files first so I can analyze them for you! üìÅ";
                }

                const lowerQuery = query.toLowerCase();
                
                // Smart query processing based on keywords
                if (lowerQuery.includes('error') || lowerQuery.includes('issue')) {
                    return analyzeErrors(query);
                } else if (lowerQuery.includes('consensus') || lowerQuery.includes('qbft')) {
                    return analyzeConsensus(query);
                } else if (lowerQuery.includes('charon')) {
                    return analyzeCharon(query);
                } else if (lowerQuery.includes('mev') || lowerQuery.includes('relay')) {
                    return analyzeMEV(query);
                } else if (lowerQuery.includes('summary') || lowerQuery.includes('overview')) {
                    return generateSummary(query);
                } else if (lowerQuery.includes('timeline') || lowerQuery.includes('time')) {
                    return analyzeTimeline(query);
                } else if (lowerQuery.includes('performance') || lowerQuery.includes('slow')) {
                    return analyzePerformance(query);
                } else if (lowerQuery.includes('search') || lowerQuery.includes('find')) {
                    return searchLogs(query);
                } else if (lowerQuery.includes('health') || lowerQuery.includes('status')) {
                    return generateHealthReport(query);
                } else {
                    return handleGeneralQuery(query);
                }
            };

            const analyzeErrors = (query) => {
                let response = "## üö® Error Analysis\n\n";
                let totalErrors = 0;
                let criticalCount = 0;

                Object.entries(logData).forEach(([filename, data]) => {
                    const analysis = data.analysis;
                    totalErrors += analysis.errors;
                    criticalCount += analysis.criticalIssues.length;

                    if (analysis.errors > 0) {
                        response += `### üìÅ ${filename}\n`;
                        response += `- **Errors:** ${analysis.errors}\n`;
                        response += `- **Critical Issues:** ${analysis.criticalIssues.length}\n\n`;

                        if (analysis.criticalIssues.length > 0) {
                            response += "**Critical Issues:**\n";
                            analysis.criticalIssues.slice(0, 3).forEach((issue, i) => {
                                response += `${i + 1}. Line ${issue.line}: ${issue.content.substring(0, 100)}...\n`;
                            });
                            response += "\n";
                        }
                    }
                });

                if (totalErrors === 0) {
                    response += "‚úÖ **Great news!** No errors detected in your DVT logs.\n\n";
                } else {
                    response += `**Total Errors:** ${totalErrors} (${criticalCount} critical)\n\n`;
                }

                response += "üìö **Obol Resources:**\n";
                response += "- [Troubleshooting Guide](https://docs.obol.org/docs/advanced/troubleshooting)\n";
                response += "- [Common Issues](https://docs.obol.org/docs/advanced/troubleshooting)\n";

                return response;
            };

            const analyzeConsensus = (query) => {
                let response = "## ü§ù DVT Consensus Analysis\n\n";
                let totalConsensusEvents = 0;

                Object.entries(logData).forEach(([filename, data]) => {
                    const events = data.analysis.consensusEvents;
                    totalConsensusEvents += events.length;

                    if (events.length > 0) {
                        response += `### üìÅ ${filename}\n`;
                        response += `- **Consensus Events:** ${events.length}\n`;
                        
                        const recentEvents = events.slice(-5);
                        response += "\n**Recent Events:**\n";
                        recentEvents.forEach((event, i) => {
                            response += `${i + 1}. Line ${event.line}: ${event.content.substring(0, 80)}...\n`;
                        });
                        response += "\n";
                    }
                });

                if (totalConsensusEvents === 0) {
                    response += "‚ö†Ô∏è **No consensus events detected.** This might indicate:\n";
                    response += "- DVT cluster not properly formed\n";
                    response += "- Charon middleware not running\n";
                    response += "- Configuration issues\n\n";
                    response += "üìñ **Setup Guide:** [Create DVT Cluster](https://docs.obol.org/docs/int/quickstart/create-cluster)\n";
                } else {
                    response += `‚úÖ **Consensus Active:** ${totalConsensusEvents} events detected\n\n`;
                    response += "üìö **Learn More:** [DVT Consensus](https://docs.obol.org/docs/learn/intro)\n";
                }

                return response;
            };

            const analyzeCharon = (query) => {
                let response = "## üîó Charon Middleware Analysis\n\n";
                let charonEvents = 0;

                Object.entries(logData).forEach(([filename, data]) => {
                    const events = data.analysis.charonEvents;
                    charonEvents += events.length;

                    if (events.length > 0) {
                        response += `### üìÅ ${filename}\n`;
                        response += `- **Charon Events:** ${events.length}\n`;
                        
                        // Look for specific Charon patterns
                        const errors = events.filter(e => e.content.toLowerCase().includes('error'));
                        const warnings = events.filter(e => e.content.toLowerCase().includes('warn'));
                        
                        if (errors.length > 0) {
                            response += `- **Charon Errors:** ${errors.length}\n`;
                        }
                        if (warnings.length > 0) {
                            response += `- **Charon Warnings:** ${warnings.length}\n`;
                        }
                        response += "\n";
                    }
                });

                response += "üìö **Charon Resources:**\n";
                response += "- [Charon Documentation](https://docs.obol.org/docs/charon/intro)\n";
                response += "- [Docker Configuration](https://docs.obol.org/docs/charon/run/docker)\n";
                response += "- [Troubleshooting Charon](https://docs.obol.org/docs/advanced/troubleshooting)\n";

                return response;
            };

            const analyzeMEV = (query) => {
                let response = "## üì° MEV-Boost Analysis\n\n";
                let mevEvents = 0;

                Object.entries(logData).forEach(([filename, data]) => {
                    const events = data.analysis.mevEvents;
                    mevEvents += events.length;

                    if (events.length > 0) {
                        response += `### üìÅ ${filename}\n`;
                        response += `- **MEV Events:** ${events.length}\n`;
                        
                        const recentEvents = events.slice(-3);
                        response += "\n**Recent MEV Activity:**\n";
                        recentEvents.forEach((event, i) => {
                            response += `${i + 1}. Line ${event.line}: ${event.content.substring(0, 80)}...\n`;
                        });
                        response += "\n";
                    }
                });

                response += "üìö **MEV Resources:**\n";
                response += "- [MEV-Boost with DVT](https://docs.obol.org/docs/advanced/mev-boost)\n";
                response += "- [Relay Configuration](https://docs.obol.org/docs/advanced/mev-boost)\n";

                return response;
            };

            const generateSummary = (query) => {
                let response = "## üìä DVT Cluster Summary\n\n";
                
                const stats = {
                    totalFiles: Object.keys(logData).length,
                    totalLines: 0,
                    totalErrors: 0,
                    totalWarnings: 0,
                    consensusEvents: 0,
                    charonEvents: 0,
                    mevEvents: 0
                };

                Object.values(logData).forEach(data => {
                    const analysis = data.analysis;
                    stats.totalLines += analysis.totalLines;
                    stats.totalErrors += analysis.errors;
                    stats.totalWarnings += analysis.warnings;
                    stats.consensusEvents += analysis.consensusEvents.length;
                    stats.charonEvents += analysis.charonEvents.length;
                    stats.mevEvents += analysis.mevEvents.length;
                });

                // Health Score Calculation
                const healthScore = Math.max(0, 100 - (stats.totalErrors * 5) - (stats.totalWarnings * 1));
                
                response += `### üè• DVT Health Score: **${healthScore}/100**\n`;
                if (healthScore >= 90) response += "‚úÖ **Excellent** - Cluster running smoothly\n";
                else if (healthScore >= 70) response += "üü° **Good** - Minor issues detected\n";
                else if (healthScore >= 50) response += "üü† **Warning** - Several issues need attention\n";
                else response += "üî¥ **Critical** - Immediate action required\n\n";

                response += "### üìà Statistics:\n";
                response += `- **Files Analyzed:** ${stats.totalFiles}\n`;
                response += `- **Total Log Lines:** ${stats.totalLines.toLocaleString()}\n`;
                response += `- **Errors:** ${stats.totalErrors}\n`;
                response += `- **Warnings:** ${stats.totalWarnings}\n`;
                response += `- **Consensus Events:** ${stats.consensusEvents}\n`;
                response += `- **Charon Activity:** ${stats.charonEvents}\n`;
                response += `- **MEV Events:** ${stats.mevEvents}\n\n`;

                response += "### üéØ Recommendations:\n";
                if (stats.totalErrors > 10) {
                    response += "- üö® High error count detected - investigate critical issues\n";
                }
                if (stats.consensusEvents === 0) {
                    response += "- ‚ö†Ô∏è No consensus activity - check DVT cluster configuration\n";
                }
                if (stats.charonEvents === 0) {
                    response += "- üîó No Charon activity detected - verify middleware is running\n";
                }

                response += "\nüìö **Quick Links:**\n";
                response += "- [Monitoring Guide](https://docs.obol.org/docs/advanced/monitoring)\n";
                response += "- [Health Checks](https://docs.obol.org/docs/advanced/monitoring)\n";

                return response;
            };

            const generateHealthReport = (query) => {
                return generateSummary(query);
            };

            const analyzeTimeline = (query) => {
                let response = "## ‚è±Ô∏è Timeline Analysis\n\n";
                
                const allTimestamps = [];
                Object.entries(logData).forEach(([filename, data]) => {
                    data.analysis.timestamps.forEach(ts => {
                        allTimestamps.push({
                            filename,
                            ...ts
                        });
                    });
                });

                if (allTimestamps.length === 0) {
                    response += "‚ùå No timestamps found in the log files.\n";
                    return response;
                }

                allTimestamps.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                const earliest = allTimestamps[0];
                const latest = allTimestamps[allTimestamps.length - 1];
                
                response += `### üìÖ Time Range:\n`;
                response += `- **Start:** ${earliest.timestamp} (${earliest.filename})\n`;
                response += `- **End:** ${latest.timestamp} (${latest.filename})\n`;
                response += `- **Total Events:** ${allTimestamps.length}\n\n`;

                // Show recent activity
                response += "### üïê Recent Activity (Last 10 events):\n";
                allTimestamps.slice(-10).forEach((event, i) => {
                    response += `${i + 1}. ${event.timestamp} - ${event.filename} (Line ${event.line})\n`;
                });

                return response;
            };

            const analyzePerformance = (query) => {
                let response = "## ‚ö° Performance Analysis\n\n";
                
                response += "Based on log analysis, here are potential performance insights:\n\n";
                
                Object.entries(logData).forEach(([filename, data]) => {
                    const analysis = data.analysis;
                    response += `### üìÅ ${filename}\n`;
                    
                    // Calculate events per line ratio
                    const eventDensity = (analysis.consensusEvents.length + analysis.charonEvents.length) / analysis.totalLines;
                    
                    if (eventDensity > 0.1) {
                        response += "üî• **High Activity** - Frequent consensus/Charon events\n";
                    } else if (eventDensity > 0.01) {
                        response += "‚ö° **Moderate Activity** - Normal consensus patterns\n";
                    } else {
                        response += "üìà **Low Activity** - Limited consensus events\n";
                    }
                    
                    response += `- Event Density: ${(eventDensity * 100).toFixed(2)}%\n`;
                    response += `- Error Rate: ${((analysis.errors / analysis.totalLines) * 100).toFixed(3)}%\n\n`;
                });

                response += "üìö **Performance Resources:**\n";
                response += "- [Performance Tuning](https://docs.obol.org/docs/advanced/performance-tuning)\n";
                response += "- [Monitoring](https://docs.obol.org/docs/advanced/monitoring)\n";

                return response;
            };

            const searchLogs = (query) => {
                const searchTerm = query.replace(/search|find|look for/gi, '').trim();
                if (!searchTerm) {
                    return "Please specify what you'd like to search for. Example: 'search for timeout errors'";
                }

                let response = `## üîç Search Results for: "${searchTerm}"\n\n`;
                let totalMatches = 0;

                Object.entries(logData).forEach(([filename, data]) => {
                    const matches = [];
                    data.lines.forEach((line, index) => {
                        if (line.toLowerCase().includes(searchTerm.toLowerCase())) {
                            matches.push({ line: index + 1, content: line.trim() });
                        }
                    });

                    if (matches.length > 0) {
                        totalMatches += matches.length;
                        response += `### üìÅ ${filename} (${matches.length} matches)\n`;
                        matches.slice(0, 5).forEach((match, i) => {
                            response += `${i + 1}. Line ${match.line}: ${match.content.substring(0, 100)}...\n`;
                        });
                        if (matches.length > 5) {
                            response += `... and ${matches.length - 5} more matches\n`;
                        }
                        response += "\n";
                    }
                });

                if (totalMatches === 0) {
                    response += `‚ùå No matches found for "${searchTerm}"\n`;
                    response += "\n**Try searching for:**\n";
                    response += "- error, warning, timeout\n";
                    response += "- consensus, qbft, leader\n";
                    response += "- charon, relay, mev\n";
                } else {
                    response += `‚úÖ **Total matches:** ${totalMatches}\n`;
                }

                return response;
            };

            const handleGeneralQuery = (query) => {
                const suggestions = [
                    "Show me all errors",
                    "Analyze consensus activity", 
                    "Check Charon status",
                    "Generate summary report",
                    "Search for timeout issues",
                    "What's my cluster health?",
                    "Show timeline of events"
                ];

                return `I understand you're asking: "${query}"

While I can provide general DVT guidance, I work best with specific commands. Here are some things you can try:

**üîç Popular Commands:**
${suggestions.map(s => `‚Ä¢ "${s}"`).join('\n')}

**üìö Or ask about:**
‚Ä¢ Specific error messages or patterns
‚Ä¢ DVT consensus behavior  
‚Ä¢ Charon middleware issues
‚Ä¢ MEV-Boost integration
‚Ä¢ Performance concerns
‚Ä¢ Configuration problems

**üìñ Obol Documentation:** [docs.obol.org](https://docs.obol.org)

What would you like to explore first?`;
            };

            const handleSendMessage = async () => {
                if (!inputMessage.trim()) return;

                const userMessage = inputMessage.trim();
                setInputMessage('');

                // Add user message
                addMessage('user', userMessage, false);

                // Process query and respond
                try {
                    const response = await processUserQuery(userMessage);
                    addMessage('assistant', response);
                } catch (error) {
                    addMessage('assistant', `‚ùå Sorry, I encountered an error processing your request: ${error.message}\n\nPlease try rephrasing your question or check that your log files are properly uploaded.`);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            const quickCommand = (command) => {
                setInputMessage(command);
                setTimeout(() => handleSendMessage(), 100);
            };

            const removeFile = (fileId) => {
                const file = files.find(f => f.id === fileId);
                if (file) {
                    setFiles(files.filter(f => f.id !== fileId));
                    const newLogData = { ...logData };
                    delete newLogData[file.name];
                    setLogData(newLogData);
                    
                    addMessage('assistant', `üóëÔ∏è Removed **${file.name}** from analysis.`, false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900">
                    <div className="container mx-auto px-4 py-6">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-white mb-2">Enhanced DVT Log Analyzer</h1>
                            <p className="text-gray-300 mb-4">Interactive AI Assistant with Obol Network Integration</p>
                            <div className="inline-block bg-green-500/20 text-green-300 px-4 py-2 rounded-full text-sm">
                                ü§ñ AI-Powered ‚Ä¢ üìö Obol Docs ‚Ä¢ üîç Interactive Analysis
                            </div>
                        </div>

                        <div className="grid lg:grid-cols-3 gap-6">
                            {/* Left Sidebar - File Management */}
                            <div className="lg:col-span-1 space-y-6">
                                {/* File Upload */}
                                <div className="bg-white/10 rounded-xl p-6 border border-white/20">
                                    <h2 className="text-lg font-bold text-white mb-4">üìÅ Upload DVT Logs</h2>
                                    
                                    <div 
                                        className="border-2 border-dashed border-white/30 rounded-lg p-6 text-center hover:border-blue-400 transition-colors cursor-pointer"
                                        onClick={() => fileInputRef.current?.click()}
                                    >
                                        <div className="text-3xl mb-2">üìÑ</div>
                                        <p className="text-white font-medium mb-1">Click to upload</p>
                                        <p className="text-gray-400 text-sm">DVT, Charon, Beacon logs</p>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            multiple
                                            accept=".log,.txt,.csv"
                                            onChange={handleFileUpload}
                                            style={{ display: 'none' }}
                                        />
                                    </div>
                                </div>

                                {/* Uploaded Files */}
                                {files.length > 0 && (
                                    <div className="bg-white/10 rounded-xl p-4 border border-white/20">
                                        <h3 className="text-white font-medium mb-3">Files ({files.length})</h3>
                                        <div className="space-y-2 max-h-60 overflow-y-auto chat-scroll">
                                            {files.map(file => (
                                                <div key={file.id} className="bg-white/5 rounded-lg p-3 flex items-center justify-between">
                                                    <div className="flex-1 min-w-0">
                                                        <p className="text-white font-medium text-sm truncate">{file.name}</p>
                                                        <p className="text-gray-400 text-xs">
                                                            {formatFileSize(file.size)} ‚Ä¢ {file.type}
                                                        </p>
                                                    </div>
                                                    <button 
                                                        onClick={() => removeFile(file.id)}
                                                        className="text-red-400 hover:text-red-300 text-sm ml-2 px-2 py-1 rounded hover:bg-red-500/10"
                                                    >
                                                        √ó
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Quick Commands */}
                                <div className="bg-white/10 rounded-xl p-4 border border-white/20">
                                    <h3 className="text-white font-medium mb-3">‚ö° Quick Commands</h3>
                                    <div className="space-y-2">
                                        {[
                                            "Generate summary report",
                                            "Show all errors",
                                            "Analyze consensus activity",
                                            "Check Charon status", 
                                            "Find MEV-Boost issues",
                                            "What's my cluster health?",
                                            "Show timeline of events"
                                        ].map((cmd, i) => (
                                            <button
                                                key={i}
                                                onClick={() => quickCommand(cmd)}
                                                className="w-full text-left bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 text-blue-200 px-3 py-2 rounded-lg text-sm transition-colors"
                                                disabled={files.length === 0}
                                            >
                                                {cmd}
                                            </button>
                                        ))}
                                    </div>
                                    {files.length === 0 && (
                                        <p className="text-gray-400 text-xs mt-2">Upload files to enable commands</p>
                                    )}
                                </div>

                                {/* Analysis Stats */}
                                {files.length > 0 && (
                                    <div className="bg-white/10 rounded-xl p-4 border border-white/20">
                                        <h3 className="text-white font-medium mb-3">üìä Quick Stats</h3>
                                        <div className="space-y-2">
                                            {Object.entries(logData).map(([filename, data]) => (
                                                <div key={filename} className="bg-white/5 rounded p-2">
                                                    <p className="text-white text-sm font-medium truncate">{filename}</p>
                                                    <div className="grid grid-cols-3 gap-2 mt-1">
                                                        <div className="text-center">
                                                            <div className="text-green-400 text-xs">{data.analysis.totalLines.toLocaleString()}</div>
                                                            <div className="text-gray-400 text-xs">Lines</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-red-400 text-xs">{data.analysis.errors}</div>
                                                            <div className="text-gray-400 text-xs">Errors</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-yellow-400 text-xs">{data.analysis.warnings}</div>
                                                            <div className="text-gray-400 text-xs">Warnings</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Main Chat Area */}
                            <div className="lg:col-span-2">
                                <div className="bg-white/10 rounded-xl border border-white/20 h-[80vh] flex flex-col">
                                    {/* Chat Header */}
                                    <div className="p-4 border-b border-white/10">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h2 className="text-white font-bold">ü§ñ DVT AI Assistant</h2>
                                                <p className="text-gray-400 text-sm">Ask me anything about your DVT logs</p>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                                <span className="text-green-400 text-sm">Online</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Messages Container */}
                                    <div className="flex-1 overflow-y-auto p-4 space-y-4 chat-scroll">
                                        {messages.map((message) => (
                                            <div key={message.id} className={`message-animation ${
                                                message.type === 'user' ? 'ml-8' : 'mr-8'
                                            }`}>
                                                <div className={`rounded-xl p-4 ${
                                                    message.type === 'user' 
                                                        ? 'bg-blue-600 text-white ml-auto' 
                                                        : 'bg-white/5 border border-white/10 text-gray-100'
                                                } max-w-full`}>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <span className="font-medium text-sm">
                                                            {message.type === 'user' ? 'üë§ You' : 'ü§ñ DVT Assistant'}
                                                        </span>
                                                        <span className="text-xs opacity-60">
                                                            {message.timestamp.toLocaleTimeString()}
                                                        </span>
                                                    </div>
                                                    <div className="prose prose-sm max-w-none">
                                                        <div dangerouslySetInnerHTML={{
                                                            __html: message.content
                                                                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                                                .replace(/^##\s(.+)$/gm, '<h3 style="color: #64ffda; margin: 16px 0 8px 0;">$1</h3>')
                                                                .replace(/^###\s(.+)$/gm, '<h4 style="color: #4fc3f7; margin: 12px 0 6px 0;">$1</h4>')
                                                                .replace(/^-\s(.+)$/gm, '<li style="margin: 4px 0;">$1</li>')
                                                                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color: #64ffda; text-decoration: underline;">$1</a>')
                                                                .replace(/\n/g, '<br>')
                                                        }} />
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {isTyping && (
                                            <div className="mr-8">
                                                <div className="bg-white/5 border border-white/10 rounded-xl p-4 max-w-xs">
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-medium text-sm">ü§ñ DVT Assistant</span>
                                                        <span className="text-xs opacity-60">typing</span>
                                                    </div>
                                                    <div className="flex items-center gap-1 mt-2 typing-animation">
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full"></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animation-delay-200"></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animation-delay-400"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        <div ref={chatEndRef} />
                                    </div>

                                    {/* Input Area */}
                                    <div className="p-4 border-t border-white/10">
                                        <div className="flex gap-2">
                                            <div className="flex-1 relative">
                                                <textarea
                                                    ref={textareaRef}
                                                    value={inputMessage}
                                                    onChange={(e) => setInputMessage(e.target.value)}
                                                    onKeyPress={handleKeyPress}
                                                    placeholder={files.length > 0 
                                                        ? "Ask me anything about your DVT logs... (e.g., 'Show me all consensus errors')"
                                                        : "Upload log files first, then ask me questions..."
                                                    }
                                                    disabled={isTyping}
                                                    className="w-full bg-white/5 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-gray-400 resize-none focus:outline-none focus:border-blue-400 focus:bg-white/10 transition-all"
                                                    style={{ minHeight: '44px', maxHeight: '120px' }}
                                                />
                                                <div className="absolute right-2 bottom-2 text-xs text-gray-500">
                                                    Press Enter to send
                                                </div>
                                            </div>
                                            <button
                                                onClick={handleSendMessage}
                                                disabled={!inputMessage.trim() || isTyping}
                                                className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-6 py-3 rounded-xl font-medium transition-colors flex items-center gap-2"
                                            >
                                                {isTyping ? (
                                                    <>
                                                        <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                                                        Processing
                                                    </>
                                                ) : (
                                                    <>
                                                        üöÄ Send
                                                    </>
                                                )}
                                            </button>
                                        </div>
                                        
                                        {/* Sample Questions */}
                                        {files.length > 0 && messages.length <= 2 && (
                                            <div className="mt-3">
                                                <p className="text-gray-400 text-xs mb-2">üí° Try asking:</p>
                                                <div className="flex flex-wrap gap-2">
                                                    {[
                                                        "What errors do you see?",
                                                        "Analyze my consensus activity",
                                                        "Check cluster health",
                                                        "Show timeline analysis"
                                                    ].map((question, i) => (
                                                        <button
                                                            key={i}
                                                            onClick={() => setInputMessage(question)}
                                                            className="bg-white/5 hover:bg-white/10 border border-white/20 text-gray-300 px-3 py-1 rounded-lg text-xs transition-colors"
                                                        >
                                                            {question}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="mt-8 text-center">
                            <div className="bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-xl p-4 border border-purple-500/30">
                                <p className="text-purple-300 text-sm mb-2">
                                    üöÄ Enhanced with Obol Network Integration ‚Ä¢ ü§ñ AI-Powered Analysis
                                </p>
                                <div className="flex justify-center gap-4 text-xs">
                                    <a href="https://docs.obol.org" target="_blank" rel="noopener" 
                                       className="text-purple-200 hover:text-purple-100 underline">
                                        üìö Obol Docs
                                    </a>
                                    <a href="https://docs.obol.org/docs/advanced/troubleshooting" target="_blank" rel="noopener" 
                                       className="text-purple-200 hover:text-purple-100 underline">
                                        üîß Troubleshooting
                                    </a>
                                    <a href="https://docs.obol.org/docs/advanced/monitoring" target="_blank" rel="noopener" 
                                       className="text-purple-200 hover:text-purple-100 underline">
                                       üìä Monitoring
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<EnhancedDVTLogAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
